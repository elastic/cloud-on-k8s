---
# Default values for eck-fleet-agent.
# This is a YAML-formatted file.

# Overridable names of the Fleet Agent resource.
# By default, this is the Release name set for the chart,
# followed by 'eck-fleet-agent'.
#
# nameOverride will override the name of the Chart with the name set here,
# so nameOverride: quickstart, would convert to '{{ Release.name }}-quickstart'
#
# nameOverride: "quickstart"
#
# fullnameOverride will override both the release name, and the chart name,
# and will name the Fleet Agent resource exactly as specified.
#
# fullnameOverride: "quickstart"

# Version of Elastic Fleet Agent.
#
version: 8.2.3

# Labels that will be applied to Elastic Fleet Agent.
#
labels: {}

# Annotations that will be applied to Elastic Fleet Agent.
#
annotations: {}

spec:
  # Referenced resources are below and depending on the setup, at least elasticsearchRef is required for a functional Fleet Agent.
  # ref: https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-beat-configuration.html#k8s-beat-connect-es
  #
  # Reference to ECK-managed Kibana resource.
  #
  kibanaRef:
    name: quickstart
    # Optional namespace reference to Kibana resource.
    # If not specified, then the namespace of the Fleet Agent resource
    # will be assumed.
    #
    # namespace: default

  # References to ECK-managed Elasticsearch resource.
  # Leave elasticsearchRefs empty or unset for any Elastic Agent running in Fleet mode as the Elasticsearch cluster to target
  # will come from Kibana xpack.fleet.agents.elasticsearch.hosts configuration element.
  #
  # elasticsearchRefs:
  # - name: elasticsearch
    # Optional namespace reference to Elasticsearch resource.
    # If not specified, then the namespace of the Fleet Agent resource
    # will be assumed.
    #
    # namespace: default
  
  mode: fleet
  fleetServerEnabled: true

  # Daemonset, or Deployment specification for the type of Fleet Agent specified.
  # At least one is required of [daemonSet, deployment].
  # ref: https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-beat-configuration.html#k8s-beat-chose-the-deployment-model
  #
  deployment:
    replicas: 1
    podTemplate:
      spec:
        serviceAccountName: fleet-server
        automountServiceAccountToken: true
        securityContext:
          runAsUser: 0

# ServiceAccount to be used by Elastic Fleet Agent. Some Fleet Agent features (such as autodiscover or Kubernetes module metricsets)
# require that Fleet Agent Pods interact with Kubernetes APIs. This functionality requires specific permissions
# ref: https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-elastic-agent-fleet-configuration.html#k8s-elastic-agent-fleet-configuration-role-based-access-control
#
serviceAccount:
  name: fleet-server
  # namespace: optional-namespace

# ClusterRoleBinding to be used by Elastic Fleet Agent. Similar to ServiceAccount, this is required in some scenarios.
# ref: https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-elastic-agent-fleet-configuration.html#k8s-elastic-agent-fleet-configuration-role-based-access-control
#
clusterRoleBinding:
  name: fleet-server
  subjects:
  - kind: ServiceAccount
    name: fleet-server
    # namespace: default
  roleRef:
    kind: ClusterRole
    name: fleet-server
    apiGroup: rbac.authorization.k8s.io

# ClusterRole to be used by Elastic Fleet Agent. Similar to ServiceAccount, this is required in some scenarios.
# ref: https://www.elastic.co/guide/en/cloud-on-k8s/current/k8s-elastic-agent-fleet-configuration.html#k8s-elastic-agent-fleet-configuration-role-based-access-control
#
clusterRole:
  name: fleet-server
  rules:
  - apiGroups: [""]
    resources:
    - pods
    - namespaces
    - nodes
    verbs:
    - get
    - watch
    - list
  - apiGroups: ["coordination.k8s.io"]
    resources:
    - leases
    verbs:
    - get
    - create
    - update
