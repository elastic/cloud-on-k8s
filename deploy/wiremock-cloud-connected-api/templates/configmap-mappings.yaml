apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "wiremock-cloud-connected-api.fullname" . }}-mappings
  namespace: {{ .Release.Namespace }}
  labels:
    {{- include "wiremock-cloud-connected-api.labels" . | nindent 4 }}
data:
  # Create Cluster API - Success (201)
  create-cluster-success.json: |
    {
      "priority": 1,
      "request": {
        "method": "POST",
        "urlPathPattern": "/api/v1/cloud-connected/clusters",
        "bodyPatterns": [
          {
            "matchesJsonPath": "$.self_managed_cluster"
          },
          {
            "matchesJsonPath": "$.license"
          }
        ]
      },
      "response": {
        "status": 201,
        "headers": {
          "Content-Type": "application/json",
          "ETag": "\"{{`{{randomValue type='UUID'}}`}}\""
        },
        "transformers": ["response-template"],
        "bodyFileName": "create-cluster-response.json"
      }
    }

  # Create Cluster API - Bad Request (400) - Missing self_managed_cluster
  create-cluster-bad-request.json: |
    {
      "priority": 3,
      "request": {
        "method": "POST",
        "urlPathPattern": "/api/v1/cloud-connected/clusters",
        "bodyPatterns": [
          {
            "doesNotMatch": ".*self_managed_cluster.*"
          }
        ]
      },
      "response": {
        "status": 400,
        "headers": {
          "Content-Type": "application/json"
        },
        "jsonBody": {
          "errors": [
            {
              "message": "Missing required field: self_managed_cluster",
              "code": "validation.required_field_missing"
            }
          ]
        }
      }
    }

  # Create Cluster API - Bad Request (400) - Missing license
  create-cluster-missing-license.json: |
    {
      "priority": 3,
      "request": {
        "method": "POST",
        "urlPathPattern": "/api/v1/cloud-connected/clusters",
        "bodyPatterns": [
          {
            "matchesJsonPath": "$.self_managed_cluster"
          },
          {
            "doesNotMatch": ".*\"license\".*"
          }
        ]
      },
      "response": {
        "status": 400,
        "headers": {
          "Content-Type": "application/json"
        },
        "jsonBody": {
          "errors": [
            {
              "message": "Missing required field: license",
              "code": "validation.required_field_missing"
            }
          ]
        }
      }
    }
