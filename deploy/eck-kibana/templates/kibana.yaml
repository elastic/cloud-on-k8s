---
apiVersion: kibana.k8s.elastic.co/v1
kind: Kibana
metadata:
  name: {{ include "kibana.fullname" . }}
  labels:
    {{- include "kibana.labels" . | nindent 4 }}
  annotations:
    eck.k8s.elastic.co/license: enterprise
    {{- toYaml .Values.annotations | indent 4 }}
spec:
  version: {{ required "A Kibana version is required" .Values.version }}
  {{- $finalSpec := .Values.spec }}
  {{- if and .Values.spec.elasticsearchRef ( not .Values.spec.elasticsearchRef.namespace ) }}
  {{- $finalSpec = mustMergeOverwrite (dict) .Values.spec (dict "elasticsearchRef" (dict "namespace" .Release.Namespace )) }}
  {{- end }}
  {{- toYaml $finalSpec | nindent 2 }}
