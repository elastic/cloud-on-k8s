agents:
  image: docker.io/library/golang:1.19.3
  memory: "4G"

steps:

  - group: "release eck resources helm charts"
    steps:

      - label: "release eck-resources helm charts dev"
        key: helm-release-eck-resources-dev
        commands:
          - make -C hack/helm/release build 2> /dev/null
          - if [[ -n "$$HELM_BRANCH" ]]; then echo "checking out $$HELM_BRANCH branch" && git checkout $$HELM_BRANCH ; fi
          - hack/helm/release/bin/releaser --env=dev --excludes=eck-operator

      - label: "release eck resources helm charts prod"
        depends_on:
          - "helm-release-eck-resources-dev"
        commands:
          - make -C hack/helm/release build 2> /dev/null
          - if [[ -n "$$HELM_BRANCH" ]]; then echo "checking out $$HELM_BRANCH branch" && git checkout $$HELM_BRANCH ; fi
          - hack/helm/release/bin/releaser --env=prod --excludes=eck-operator
