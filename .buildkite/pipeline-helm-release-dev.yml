agents:
  provider: "gcp"
  image: "family/elastic-buildkite-agent-ubuntu-2004-lts"
  machineType: "n1-standard-16"

env:
  # This credential file is created by .buildkite/scripts/common/get-helm-credentials.sh
  GCP_CREDS_FILE: ".ci/credentials.json"
  VAULT_ROOT_PATH: "secret/release/gcp"

steps:

  - group: release helm charts to dev bucket, and helm chart repository
    steps:
      - label: ":helm: run helm-charts-publisher"
        commands:
          - .buildkite/scripts/common/get-helm-credentials.sh
          # This defaults to dev bucket/chart-repo-url
          - /entrypoint.sh charts_dir=./deploy --upload-index
        plugins:
        - docker#v5.3.0:
            image: "docker.elastic.co/eck-dev/helm-charts-publisher:2022111800"
