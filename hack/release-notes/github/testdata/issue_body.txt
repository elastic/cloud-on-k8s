<p>This PR introduces first iteration of CRD for Beats and it's updated to reflect most recent changes.</p>\n<h3>Look &amp; feel</h3>\n<h4>Filebeat</h4>\n<div class=\"highlight highlight-text-shell-session\"><pre>$ <span class=\"pl-s1\">kubectl get beat filebeat-sample</span>\n<span class=\"pl-c1\">NAME              HEALTH   AVAILABLE   EXPECTED   TYPE       VERSION   AGE</span>\n<span class=\"pl-c1\">filebeat-sample   green    3           3          filebeat   7.6.2     2m7s</span>\n\n$ <span class=\"pl-s1\">kubectl tree beat filebeat-sample</span>\n<span class=\"pl-c1\">NAMESPACE  NAME                                                             READY  REASON  AGE</span>\n<span class=\"pl-c1\">default    Beat/filebeat-sample                                             -              19s</span>\n<span class=\"pl-c1\">default    ├─DaemonSet/filebeat-sample-beat-filebeat                        -              16s</span>\n<span class=\"pl-c1\">default    │ ├─ControllerRevision/filebeat-sample-beat-filebeat-7f7667d58b  -              16s</span>\n<span class=\"pl-c1\">default    │ ├─Pod/filebeat-sample-beat-filebeat-pnx85                      True           16s</span>\n<span class=\"pl-c1\">default    │ ├─Pod/filebeat-sample-beat-filebeat-wmnvb                      True           16s</span>\n<span class=\"pl-c1\">default    │ └─Pod/filebeat-sample-beat-filebeat-x5rtf                      True           16s</span>\n<span class=\"pl-c1\">default    ├─Secret/filebeat-sample-beat-es-ca                              -              17s</span>\n<span class=\"pl-c1\">default    ├─Secret/filebeat-sample-beat-filebeat-config                    -              17s</span>\n<span class=\"pl-c1\">default    ├─Secret/filebeat-sample-beat-user                               -              17s</span>\n<span class=\"pl-c1\">default    └─ServiceAccount/elastic-operator-beat-filebeat-sample-d7fb      -              17s</span></pre></div>\n<h4>Heartbeat</h4>\n<div class=\"highlight highlight-text-shell-session\"><pre>$ <span class=\"pl-s1\">kubectl get beat heartbeat-sample</span>\n<span class=\"pl-c1\">NAME               HEALTH   AVAILABLE   EXPECTED   TYPE        VERSION   AGE</span>\n<span class=\"pl-c1\">heartbeat-sample   green    1           1          heartbeat   7.6.2     10h</span>\n\n$ <span class=\"pl-s1\">kubectl tree beat heartbeat-sample</span>\n<span class=\"pl-c1\">NAMESPACE  NAME                                                          READY  REASON  AGE</span>\n<span class=\"pl-c1\">default    Beat/heartbeat-sample                                         -              10h</span>\n<span class=\"pl-c1\">default    ├─Deployment/heartbeat-sample-beat-otherbeat                  -              10h</span>\n<span class=\"pl-c1\">default    │ └─ReplicaSet/heartbeat-sample-beat-otherbeat-c8645b56       -              10h</span>\n<span class=\"pl-c1\">default    │   └─Pod/heartbeat-sample-beat-otherbeat-c8645b56-cr4f8      True           10h</span>\n<span class=\"pl-c1\">default    ├─Secret/heartbeat-sample-beat-es-ca                          -              10h</span>\n<span class=\"pl-c1\">default    ├─Secret/heartbeat-sample-beat-otherbeat-config               -              10h</span>\n<span class=\"pl-c1\">default    ├─Secret/heartbeat-sample-beat-user                           -              10h</span>\n<span class=\"pl-c1\">default    └─ServiceAccount/elastic-operator-beat-heartbeat-sample-8d7e  -              10h</span></pre></div>\n<h3>Features</h3>\n<ul>\n<li>native support for Filebeat and Metricbeat</li>\n<li>initial support for other Beats</li>\n<li>support for daemonsets and deployments</li>\n<li>providing Beat status</li>\n<li>basic webhook/non-webhook validation</li>\n<li>rollout for config/version changes</li>\n<li>labelling for all created resources</li>\n<li>support for pod template/config overriding</li>\n<li>basic apm/events/logging</li>\n<li>RBAC for autodiscovery setup (can be disabled via operator flag, separate issue at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"624134796\" data-permission-text=\"Title is private\" data-url=\"https://github.com/elastic/cloud-on-k8s/issues/3134\" data-hovercard-type=\"issue\" data-hovercard-url=\"/elastic/cloud-on-k8s/issues/3134/hovercard\" href=\"https://github.com/elastic/cloud-on-k8s/issues/3134\">#3134</a>)</li>\n</ul>\n<h3>Additional notes</h3>\n<h4>State</h4>\n<p>This is the first pass, meta-issue was created (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"616450654\" data-permission-text=\"Title is private\" data-url=\"https://github.com/elastic/cloud-on-k8s/issues/3040\" data-hovercard-type=\"issue\" data-hovercard-url=\"/elastic/cloud-on-k8s/issues/3040/hovercard\" href=\"https://github.com/elastic/cloud-on-k8s/issues/3040\">#3040</a>) for additional context and work tracking. There is couple of open issues to discuss PSP/SCC treatment (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"624128612\" data-permission-text=\"Title is private\" data-url=\"https://github.com/elastic/cloud-on-k8s/issues/3133\" data-hovercard-type=\"issue\" data-hovercard-url=\"/elastic/cloud-on-k8s/issues/3133/hovercard\" href=\"https://github.com/elastic/cloud-on-k8s/issues/3133\">#3133</a>), default/merging config (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"616507574\" data-permission-text=\"Title is private\" data-url=\"https://github.com/elastic/cloud-on-k8s/issues/3042\" data-hovercard-type=\"issue\" data-hovercard-url=\"/elastic/cloud-on-k8s/issues/3042/hovercard\" href=\"https://github.com/elastic/cloud-on-k8s/issues/3042\">#3042</a>) and autodiscover RBAC (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"624134796\" data-permission-text=\"Title is private\" data-url=\"https://github.com/elastic/cloud-on-k8s/issues/3134\" data-hovercard-type=\"issue\" data-hovercard-url=\"/elastic/cloud-on-k8s/issues/3134/hovercard\" href=\"https://github.com/elastic/cloud-on-k8s/issues/3134\">#3134</a>).</p>\n<h4>Testing</h4>\n<p>I was able to run Filebeat, Metricbeat and Heartbeat successfully, change config, upgrade versions. Some E2E are added for couple basic scenarios and SmokeTest runs with Filebeat now. Tested on OpenShift as well. There is a facility introduced that helps with querying ES and checking whether Beats events really appear in ES. In E2E tests autodiscover RBAC is managed by the operator, while the correct PSP is granted to the operator similarly to other stack products. This will be improved to grant additional permissions only to Beat pods and avoid escalating operator privileges unnecessarily.</p>\n<p>Also, at some point, tested manually with:</p>\n<ul>\n<li>Filebeat config targeting specific namespaces, labels</li>\n<li>output overriden</li>\n<li>multiple Beats, multiple Beats per namespace</li>\n</ul>\n<h4>Beat support</h4>\n<p>Only filebeat and metricbeat are supported natively. Other beats can be deployed, but only  when both <code>image</code> and <code>config</code> are provided.</p>\n<h4>Config handling</h4>\n<p>As this deserves an issue of it's own to discuss (<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"616507574\" data-permission-text=\"Title is private\" data-url=\"https://github.com/elastic/cloud-on-k8s/issues/3042\" data-hovercard-type=\"issue\" data-hovercard-url=\"/elastic/cloud-on-k8s/issues/3042/hovercard\" href=\"https://github.com/elastic/cloud-on-k8s/issues/3042\">#3042</a>), I'll just sum up what is currently in the code: if no <code>spec.config</code> is provided we use a static, default config from <code>controller/common/beat/filebeat/config.go</code>, otherwise we use the provided config. The only merging we do is the <code>output</code> if <code>elasticsearchRef</code> was provided.</p>
