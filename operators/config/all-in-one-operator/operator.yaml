# All in one operator running all controllers in a single namespace
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: elastic-operator
  namespace: $NAMESPACE_OPERATOR_NAMESPACE
  labels:
    control-plane: elastic-operator
    controller-tools.k8s.io: "1.0"
spec:
  selector:
    matchLabels:
      control-plane: elastic-operator
      controller-tools.k8s.io: "1.0"
  serviceName: elastic-operator
  template:
    metadata:
      labels:
        control-plane: elastic-operator
        controller-tools.k8s.io: "1.0"
    spec:
      serviceAccountName: elastic-operator
      containers:
      - image: $OPERATOR_IMAGE
        imagePullPolicy: Always
        name: manager
        args: ["manager", "--development", "--namespace", "$MANAGED_NAMESPACE", "--auto-install-webhooks=false"]
        env:
          - name: OPERATOR_NAMESPACE
            valueFrom:
              fieldRef:
                fieldPath: metadata.namespace
          - name: WEBHOOK_SECRET
            value: webhook-server-secret
          - name: WEBHOOK_PODS_LABEL
            value: elastic-operator
          - name: OPERATOR_IMAGE
            value: $OPERATOR_IMAGE
        resources:
          limits:
            cpu: 100m
            memory: 30Mi
          requests:
            cpu: 100m
            memory: 20Mi
        volumeMounts:
        - mountPath: /tmp/cert
          name: cert
          readOnly: true
      terminationGracePeriodSeconds: 10
      volumes:
      - name: cert
        secret:
          defaultMode: 420
          secretName: webhook-server-secret
---
apiVersion: v1
data:
  ca-cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMwakNDQWJxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFhTVJnd0ZnWURWUVFERXc5M1pXSm8KYjI5ckxXTmxjblF0WTJFd0hoY05NVGt3TXpJNE1UVXpPVEEyV2hjTk1qa3dNekkxTVRVek9UQTJXakFhTVJndwpGZ1lEVlFRREV3OTNaV0pvYjI5ckxXTmxjblF0WTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3CmdnRUtBb0lCQVFEUzNBdWRzaTBtMGdiUUxyL04wMmxPdmRnbDVLYWt1QlFSTXZrWWdadVlLcWQ2YVIrQlpRUGEKc3ZxaTBXai9ZRFR6aUpTcEJnczBJR0hZVjJQQk1aNjd4VDhnSUxnMGhJYzFYYlEydXlkRGV6VURKclB1NXhRdgphWDVwZEJORmRlQnlEb21qRXhTSEJiL3N3OVltd3QveU9LN1A4T0MwaEhVVCtYMW5WY1FjQzlpMy92RUVPM3ZMCkV1a1Brdm9xWnJVclNRcUNIKzlFdFFnMGRqNnBLQnhGWWdPYUpYVFY4TnJVK1U0aHRsQlpPRGllbEpIWU0vSEQKdFRqRE41MjByNUxPbGlKNDE0a3U5Y2tZbVVHMllEUkRBUWM5ZXNLdFFOeVFQOE9jTVRWRnFQb0JBUGpMcjNYTgp2ZG9jR1FlZDdISEw0ektEdU5vRTBVT3MzYmxWY0o0SEFnTUJBQUdqSXpBaE1BNEdBMVVkRHdFQi93UUVBd0lDCnBEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ0toWDVsOG10ZmVaV2QKdVB3YVcvVDRyekwxSzRPYkV0eXQwY3gvejFQdDhWWE53eS82cndvRTFZeHRzRlppZGcrZllmY2RBQzNaekc1WApPM2JLKzZmYTZmbFNRVUp0a3JyZ1B6NmMxNStib21DVTJWdmhMRm5Ma24wVmdUdEx5QnFMcWZLaVZIdEtkUUl4CmFoY2ZlMGpXaEtvaXJrY2JBSG9EbFRVUjRENDlha0JidlpVYmlPano5WHNqSTRUZS9TN2laOUJlR1h0bHdqM24KQVVRQ1BRT2xKUC9zRUFBeWE1SElsVXNPU1VIWTVBS3ptcC9WeEE5SkxJd09UVGlKV25EVmMxUUtKMDY1ajNnKwpuOEZxU3Z5emEzWnVTQ3FIN0k0TWkvenh2R2J3cUZ1VUNna1Q2R0lMYXYxYjUrUmdjMDlrQ2p3ejdUUEFoK2pkCllhMkIwVm9ICi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  ca-key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBMHR3TG5iSXRKdElHMEM2L3pkTnBUcjNZSmVTbXBMZ1VFVEw1R0lHYm1DcW5lbWtmCmdXVUQyckw2b3RGby8yQTA4NGlVcVFZTE5DQmgyRmRqd1RHZXU4VS9JQ0M0TklTSE5WMjBOcnNuUTNzMUF5YXoKN3VjVUwybCthWFFUUlhYZ2NnNkpveE1VaHdXLzdNUFdKc0xmOGppdXovRGd0SVIxRS9sOVoxWEVIQXZZdC83eApCRHQ3eXhMcEQ1TDZLbWExSzBrS2doL3ZSTFVJTkhZK3FTZ2NSV0lEbWlWMDFmRGExUGxPSWJaUVdUZzRucFNSCjJEUHh3N1U0d3plZHRLK1N6cFlpZU5lSkx2WEpHSmxCdG1BMFF3RUhQWHJDclVEY2tEL0RuREUxUmFqNkFRRDQKeTY5MXpiM2FIQmtIbmV4eHkrTXlnN2phQk5GRHJOMjVWWENlQndJREFRQUJBb0lCQUN0ZUZJbUhodC9RSEpTZQp1TlkxWUJoUTFXN2R1eVJ2czdqaDJmZWZXSWdRWmNlNGJVRm9yRVZEd0diU1dSMEZCWDc5SFU0eUx3VzJqMGsyCm1BNjVET09qcXRzSnY3a1ZkTldXQXlXcWttVy9wbVNTaGpsaGozWTg1VUg5SEtXUm0rcjVjSGQ0eWlVSEdyVXcKaGhBTXpwQjc5Z0JRazNhdE00TTdNZjZaMWk3S0pXS240dFhIazFsdlBINWR2S0ZVM3REeTZxSzFpRHcxUEc3cQprRUxHaTNQT1Jod0Z6U2ZGQ016QlhvdzZ3aG9VUFBxSTdLb1hxTTJidGc2dUsrYTJLWGUzWm1LZEhSRFdzeDI4CkY0QmFaVG1QQTlSSGNicDdPS0FKZTJlakM4azRhbkNoamFHVUtMdEVhUGtUcVdSZkNwSXlwdVBMdmdtR0puU2IKSVc5OUw2a0NnWUVBNW1JOHhYQjI1eXR6Qm0wYkJMQ0d6SUQvdmkxVXltUkN1VjFlYTBuSWF3cHFEWHAxR3BjZQptVXdQemNUVExxS2FIYUZDbU5zaGdaZ3ZyQ0ovbmI1QXFqcXV3YTlESUZ4RVlJWTJoWmJzREVnY0RQREM5VlAxCkFuajNtYzRPOVJiQVRXWDVUcXFaNUpXVkdxMUlBbGhoSmRQdUhkZmFxc3B1K1doNFVXakFiazBDZ1lFQTZrNFAKdFJJQTEySEs5aTk3eTZKZ1M1NmNhdEpCUFpKcWxiZWtPK0hDMURCYlk0aXpQR3FUa2VWbkJHTXEvamd0a3QvaQpONGZUTzZ0dEsxYzdmakJsckx3VFV5YUozKzBLUVp3azFYTk92N3NtcWxySlJtMXQ1MGtzVkxUL2hqM1ZTaEpTCmJ0Ni9WZHdVcitnZzZjVVc3a1lsTCtYcWZxc3RTRXZzellEemI2TUNnWUVBazNiY0NWRUVldEcvN2FRV3dEaXgKLytLdVVDKzU3MWFmc3dERnVBemhRVXJJT1ZwaDdLUkFUTVYzOURFQkwvK2FnRTdCVHhBc2NVUlZkMndabllHeQo2SU5wYXNaaFJDeHJCQkhFZ2x2cE9hOUtiU29LMEhkdUE2Z2tiSW1OMzJreHJCa1NyRHpkQm9pTWlTZlRTTlVEClVmQkdvVW1TU1BJTWVJNWJQVmk4bTUwQ2dZRUF6ZDQrd05zTHNETDFzTyt4dHc5NXlwZVhXZWhaZUc4Z2hXSHcKeE1pdGRlRHpPM1pOL2VTcXVzTTBpODlTWkVJYUVQWHovdFN4emJqbTEvRHlqZ0thSTNheENCdFJnMVh6OEFmdworVGN5VnhacWQ3NERJWVZlenB3bGZsdjJOQTQ2VExYaWhoWGpTZDV3c3NxanVLTDZiZXRtR3pySm1maHZkaGwzCi9HeXorRDhDZ1lBdnpYdjMvYmVSemZBdW84RjZqb29iL2JLL2FNeHp5NG50WDUxQy9pTFhnMVF5YnZ3NjFQdDcKdWROVU5MUUVFLzBoc2JoYWt4YzVxZVRCcWNHRkZKTVdid25pS2picWlFT0t1cXRrRnFtRTNaZ3lrR0V4UUgxSwpVb2RSVHhENXhoc3o3d1Z6cWMvK01pUjlhZ2lDTEZ1eGVBUDBxNjJ0WURMMWVzMUJuQnYxMUE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
  cert.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvVENDQWVXZ0F3SUJBZ0lJSUdJMFFlQ0x5YUl3RFFZSktvWklodmNOQVFFTEJRQXdHakVZTUJZR0ExVUUKQXhNUGQyVmlhRzl2YXkxalpYSjBMV05oTUI0WERURTVNRE15T0RFMU16a3dObG9YRFRJd01ETXlOekUxTlRZegpORm93T2pFNE1EWUdBMVVFQXhNdmQyVmlhRzl2YXkxelpYSjJhV05sTG1Wc1lYTjBhV010Ym1GdFpYTndZV05sCkxXOXdaWEpoZEc5eWN5NXpkbU13Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXdnZ0VLQW9JQkFRQy8KQkVNUzd2Y2lPbWg5NmJPUS9FTmc0aFFjUVVrcWliM1I2YnZacjE3VGhkRHpvWWZGWXdTVGVXVCttZXdJUkZJNwpVQWNLc0RCK0hKdldmeTh5QnFwWXNYRlRKdSsyaURlUVdTWGFjQXA1M2JkbWlCVWdJQW1tK3Zta3NtWSs2aXJsCjFNdHZxVXN5K3FyNVJRMVphbWhrWk00M2ZhbUJaZVdFR1dVOTFUa3NqTXk5VHBicUR4NU4xVFFxNjB1dE5USjcKb21rMnlLbXJpLzBLU2c0c2dpd0wyMlRBUVpQL0VTWDA3U0gzUjFtbmc3QXdWaDB2dTJGeSs5U3gvV1NHbHIzRApRUmhDWTM4TnlncDhnQUFXM1hwVVNjWXhpY1dBa2hsTHdvc2F3d05qZjI1ZVk4U0p3Vm5YejhwS1NtSW9LSWxlCllPWUczY1VxLzRKVVNNcFlBYzNKQWdNQkFBR2pKekFsTUE0R0ExVWREd0VCL3dRRUF3SUZvREFUQmdOVkhTVUUKRERBS0JnZ3JCZ0VGQlFjREFUQU5CZ2txaGtpRzl3MEJBUXNGQUFPQ0FRRUFaYkdMdmhXamJzeTVlRHFxWUxZNgpqNFlualg0VldDYmxmaUk2TEVsUkd4N1Q1ZjdjL0JQM01vd1RQbVlwTHRMQmJDUm9DTDM0WjdzRWgxSmY2eGk3CmZTaTlBbUh6RXlLNVRnOGdjWVZmOXBCMG1WVWhDMUFaRnVWaFpMVlVXTmhCZk1XV1ZPZTlrWjJySENJNk11dTMKWEptVGpocVBzUG1OYnphZi80M2dTR3Btd1JXKyt2N0MzZm9kK1VLNVJ1bE9jT2V2L0tXRjRzWTJxUDNqRnVISQpYOTJSeTR0NSsxdUVldFZKUVNKdWIwbjZZQUFva3F5ZHVKYkwySFI1Ym5RRlpIS0hCWlVqY3dHQUxqbUFVMXFwCmhGRk5sVnZKdFozK3E3V3hvbm12Z055elE4NUljRGErMmN1RXFva3NWTHRPYmJKRWpMWE5TOFY1WW1OeTBsU2wKU2c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  key.pem: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdndSREV1NzNJanBvZmVtemtQeERZT0lVSEVGSktvbTkwZW03MmE5ZTA0WFE4NkdICnhXTUVrM2xrL3Buc0NFUlNPMUFIQ3JBd2ZoeWIxbjh2TWdhcVdMRnhVeWJ2dG9nM2tGa2wybkFLZWQyM1pvZ1YKSUNBSnB2cjVwTEptUHVvcTVkVExiNmxMTXZxcStVVU5XV3BvWkdUT04zMnBnV1hsaEJsbFBkVTVMSXpNdlU2Vwo2ZzhlVGRVMEt1dExyVFV5ZTZKcE5zaXBxNHY5Q2tvT0xJSXNDOXRrd0VHVC94RWw5TzBoOTBkWnA0T3dNRllkCkw3dGhjdnZVc2Yxa2hwYTl3MEVZUW1OL0Rjb0tmSUFBRnQxNlZFbkdNWW5GZ0pJWlM4S0xHc01EWTM5dVhtUEUKaWNGWjE4L0tTa3BpS0NpSlhtRG1CdDNGS3YrQ1ZFaktXQUhOeVFJREFRQUJBb0lCQVFDYzdWSnhicExuc3RaLwpnd3k3c3hOanQ3aFAwaTdhM0podXFMaGtTVmY5TExXU1FnVTUyM1E1K0FSSnlvaUg3aUVraTBXTnVWdk5iNUZ6CnNiOURPUWlmbnY5OEVjUGowSnJkWXUvZk9pYlJJWjUzaEpyZWJwT2ZkQmErQUxaUlA2NEliVDdJdUd1SU1UbGYKV2lSeWJpSGZRSlhPTHRXZjhlZVNGQThCc25lcktZRzg5ZjdyUmpqYTcxdXdtOGlaTmZEMFI4ZHh4Z2FiWTVPaworRS9sdXp1MnBtWEpsNk5QVGcwKzVnRC9lZEQ2ZkVaemY5Ymh3L2FublV4bkVtMkhWYTVHNW5lMHNGRGE1VDNkCnBESTJrd0xRRURQV2RpWmg0Q1BLclB0eWxoSzlKWjNPUERiUEFOMWxUTng2ZHVFT09aNUpCdWZ4TktNOW9VRGcKd28rMlppVUZBb0dCQU9XVTRNYS9LaVlzYXZBZCtDUk5EbWtNSUtrWm0wUlZhdktDdEl1VzQ1aFZDcndXRjhlcgoydlZrWGRqMmdkR0hiNUZmOENCcG5BMERUUUFFUUdUWlQ2aVhYRTY4RytVOUM2QjhZV3pMUUpWWFRaZTN2MlJnCnR4SXZtZTlLcW1xWkZaTldLNlVNcXRoODVRbWlmd1hDYmM5MFNpUjJxSk93NGFSWmZSS1RJNHM3QW9HQkFOVC8KVWh1Y0dEaFJtNjhDTmh2dEc2Vk5vVzJHdUlneVBCSlpQQ29Wa2FNaVlZeElvSk9vaDI1c2tlUXBoVWRkUXVxMQpPbm1XZGlzZFpKSTNFelEvRks4dDlDYlNRVzV0YVh4cnYxa2VFTzZkd0pkQjc4a2lYNFAwd3cweVRFc29zc1VQCnA5STM0bHV2OHhhelVEd0VZS3g3NUdFNDQ1TjJJVDJWUzFMR0ZOTExBb0dBZm40cDNyZUROS2N5Z0h3eXRXV1QKZEFPUGx6d1psV3Z1MGhGOEFwRXZjMFlmOVFQRE5HdVc1Ni9XR1cyd2wwNmxCUmMwQ2RmR2VGRUNRdWtVeGJ3SwpMTnpBcWt6d25ieWx4Rlhqby9yVTZiUEJkNzl3LzVCZUxmSDJRYWNGQUZpNlQ0U2g1WDEyUUhPSUNtZnl6cXlTCnJrUG5lZkc2N2l6K0ZmeU1jZ2lLQS9NQ2dZQU1laFJXTjdPWGdQaE1yU1Y4UjB4cVIzemdUSmI4cTJ5bmFvREMKdWxhNHBxZnVMc2J4UDFzSGxlYUo1Z0MvcUcvbURjMnFGNjArWTA5ajNVUUx1SEkrdk1OampzZDBiNFpSV29Kdgo5dm5vOEdhNnRZc1ZUaVVvTnF0Q1Y2THVlQ2pZc0UwVlhGNnZIa1J3SFByak9TSnNtQ2xOcEtaNEdlQmltaDg2CmJ3NEROd0tCZ1FEUVhYOVYvNVQrNGJYdmk5Mi9Cb1Vhei9WMHlMOGFhajc4TGNpTUlmMTllMGVwSzNjV25FVGEKNmVXQVNlQUlsUEF0eStpZzJKTURDZllPU21qaXFEWmNyb0tscUJwOU5UOWliVXYwY1h2UnhMNy9uUDgrOE91VwppY2ZCdWxsZ25oZDk1QmczdzZBL0puVEQ0dkthMkV6QWw5MmhNSkZYR2JpNGxITjc1cHF2NFE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
kind: Secret
metadata:
  creationTimestamp: null
  name: webhook-server-secret
  namespace: $NAMESPACE_OPERATOR_NAMESPACE
---
apiVersion: v1
kind: Service
metadata:
  creationTimestamp: null
  name: webhook-service
  namespace: $NAMESPACE_OPERATOR_NAMESPACE
spec:
  ports:
  - port: 443
    targetPort: 443
  selector:
    control-plane: elastic-operator
status:
  loadBalancer: {}
---
apiVersion: admissionregistration.k8s.io/v1beta1
kind: ValidatingWebhookConfiguration
metadata:
  creationTimestamp: null
  name: es-validating-webhook-cfg
webhooks:
- clientConfig:
    caBundle: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMwakNDQWJxZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFhTVJnd0ZnWURWUVFERXc5M1pXSm8KYjI5ckxXTmxjblF0WTJFd0hoY05NVGt3TXpJNE1UVXpPVEEyV2hjTk1qa3dNekkxTVRVek9UQTJXakFhTVJndwpGZ1lEVlFRREV3OTNaV0pvYjI5ckxXTmxjblF0WTJFd2dnRWlNQTBHQ1NxR1NJYjNEUUVCQVFVQUE0SUJEd0F3CmdnRUtBb0lCQVFEUzNBdWRzaTBtMGdiUUxyL04wMmxPdmRnbDVLYWt1QlFSTXZrWWdadVlLcWQ2YVIrQlpRUGEKc3ZxaTBXai9ZRFR6aUpTcEJnczBJR0hZVjJQQk1aNjd4VDhnSUxnMGhJYzFYYlEydXlkRGV6VURKclB1NXhRdgphWDVwZEJORmRlQnlEb21qRXhTSEJiL3N3OVltd3QveU9LN1A4T0MwaEhVVCtYMW5WY1FjQzlpMy92RUVPM3ZMCkV1a1Brdm9xWnJVclNRcUNIKzlFdFFnMGRqNnBLQnhGWWdPYUpYVFY4TnJVK1U0aHRsQlpPRGllbEpIWU0vSEQKdFRqRE41MjByNUxPbGlKNDE0a3U5Y2tZbVVHMllEUkRBUWM5ZXNLdFFOeVFQOE9jTVRWRnFQb0JBUGpMcjNYTgp2ZG9jR1FlZDdISEw0ektEdU5vRTBVT3MzYmxWY0o0SEFnTUJBQUdqSXpBaE1BNEdBMVVkRHdFQi93UUVBd0lDCnBEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBQTRJQkFRQ0toWDVsOG10ZmVaV2QKdVB3YVcvVDRyekwxSzRPYkV0eXQwY3gvejFQdDhWWE53eS82cndvRTFZeHRzRlppZGcrZllmY2RBQzNaekc1WApPM2JLKzZmYTZmbFNRVUp0a3JyZ1B6NmMxNStib21DVTJWdmhMRm5Ma24wVmdUdEx5QnFMcWZLaVZIdEtkUUl4CmFoY2ZlMGpXaEtvaXJrY2JBSG9EbFRVUjRENDlha0JidlpVYmlPano5WHNqSTRUZS9TN2laOUJlR1h0bHdqM24KQVVRQ1BRT2xKUC9zRUFBeWE1SElsVXNPU1VIWTVBS3ptcC9WeEE5SkxJd09UVGlKV25EVmMxUUtKMDY1ajNnKwpuOEZxU3Z5emEzWnVTQ3FIN0k0TWkvenh2R2J3cUZ1VUNna1Q2R0lMYXYxYjUrUmdjMDlrQ2p3ejdUUEFoK2pkCllhMkIwVm9ICi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    service:
      name: webhook-service
      namespace: $NAMESPACE_OPERATOR_NAMESPACE
      path: /validate-elasticsearches
  failurePolicy: Fail
  name: validation.elasticsearch.elastic.co
  namespaceSelector:
    matchExpressions:
    - key: control-plane
      operator: DoesNotExist
  rules:
  - apiGroups:
    - elasticsearch.k8s.elastic.co
    apiVersions:
    - v1alpha1
    operations:
    - CREATE
    - UPDATE
    resources:
    - elasticsearches